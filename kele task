<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯ä¹æˆå°±ç³»ç»Ÿ</title>
    <style>
        :root {
            --primary: #FFC107;
            --secondary: #FFA000;
            --accent: #FF9800;
            --light: #f5f5f5;
            --dark: #333;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        
        body {
            background-color: #f0f8ff;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: white;
            border-radius: 50px;
            padding: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .tab.active {
            background: var(--primary);
            color: white;
        }
        
        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .points-display {
            background: var(--accent);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 20px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr);
            gap: 1px;
            background-color: #ddd;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 20px;
        }
        
        .calendar-header {
            background-color: var(--primary);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .time-slot {
            background-color: var(--light);
            padding: 10px 5px;
            text-align: center;
            font-weight: bold;
            border-right: 1px solid #ddd;
        }
        
        .day-column {
            display: flex;
            flex-direction: column;
        }
        
        .day-cell {
            min-height: 70px;
            padding: 5px;
            background-color: white;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .day-cell:hover {
            background-color: #f9f9f9;
        }
        
        .day-cell.empty {
            background-color: #f9f9f9;
        }
        
        .task {
            background: var(--light);
            padding: 8px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            font-size: 0.9rem;
            cursor: default;
        }
        
        .task.completed {
            opacity: 0.7;
            background: #e8f5e9;
        }
        
        .task-points {
            background: var(--secondary);
            color: white;
            padding: 2px 6px;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
            background: var(--primary);
            color: var(--dark);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            background: var(--secondary);
            color: white;
        }
        
        .btn-small {
            padding: 4px 8px;
            font-size: 0.8rem;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
        }
        
        .btn-warning {
            background: #ff9800;
            color: white;
        }
        
        .btn-warning:hover {
            background: #f57c00;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .time-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .tomato-timer {
            text-align: center;
            margin: 30px 0;
        }
        
        .timer-display {
            font-size: 5rem;
            font-weight: bold;
            color: var(--primary);
            margin: 20px 0;
        }
        
        .rewards-list, .history-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .reward-card, .history-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .reward-card:hover, .history-card:hover {
            border-color: var(--accent);
            transform: translateY(-5px);
        }
        
        .reward-cost {
            background: var(--accent);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        
        .reward-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #999;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .delete-btn:hover {
            background: #f5f5f5;
            color: #f44336;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .history-date {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .task-time {
            font-size: 0.7rem;
            color: #666;
        }
        
        .add-task-hint {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
            margin-top: 10px;
        }
        
        .task-description {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        .task-actions {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .calendar-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .calendar-grid {
                grid-template-columns: 60px repeat(7, 1fr);
                font-size: 0.8rem;
            }
            
            .timer-display {
                font-size: 3.5rem;
            }
            
            .rewards-list, .history-list {
                grid-template-columns: 1fr;
            }
            
            .time-inputs {
                flex-direction: column;
            }
            
            .reward-actions {
                flex-direction: column;
                gap: 5px;
            }
            
            .calendar-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ­ å¯ä¹æˆå°±ç³»ç»Ÿ ğŸ­</h1>
            <p>å®Œæˆä»»åŠ¡ï¼Œèµšå–ç§¯åˆ†ï¼Œå…‘æ¢å¥–åŠ±ï¼</p>
        </header>
        
        <div class="points-display">
            æˆ‘çš„ç§¯åˆ†: <span id="total-points">0</span>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="calendar">ä»»åŠ¡æ—¥å†</div>
            <div class="tab" data-tab="tomato">ç•ªèŒ„é’Ÿ</div>
            <div class="tab" data-tab="rewards">å¥–åŠ±å…‘æ¢</div>
            <div class="tab" data-tab="history">å…‘æ¢è®°å½•</div>
        </div>
        
        <div id="calendar-tab" class="tab-content active">
            <div class="calendar-actions">
                <button id="add-task-btn" class="btn">æ·»åŠ æ–°ä»»åŠ¡</button>
                <button id="clear-tasks-btn" class="btn btn-danger">æ¸…é™¤æ‰€æœ‰ä»»åŠ¡</button>
            </div>
            
            <div class="add-task-hint">æç¤ºï¼šç‚¹å‡»æ—¥å†ä¸­çš„æ—¶é—´æ ¼å­ä¹Ÿå¯ä»¥æ·»åŠ ä»»åŠ¡</div>
            
            <div class="calendar-grid" id="calendar-grid">
                <!-- æ—¥å†ç½‘æ ¼å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div id="tomato-tab" class="tab-content">
            <div class="tomato-timer">
                <h2>ç•ªèŒ„å·¥ä½œæ³•è®¡æ—¶å™¨</h2>
                <p>è®¾ç½®ä¸“æ³¨æ—¶é—´ï¼Œå®Œæˆä»»åŠ¡æ›´é«˜æ•ˆï¼</p>
                
                <div class="form-group">
                    <label for="timer-minutes">ä¸“æ³¨æ—¶é—´ (åˆ†é’Ÿ)</label>
                    <input type="number" id="timer-minutes" value="25" min="5" max="60">
                </div>
                
                <div class="timer-display" id="timer-display">25:00</div>
                
                <button id="start-timer" class="btn">å¼€å§‹ä¸“æ³¨</button>
                <button id="pause-timer" class="btn" disabled>æš‚åœ</button>
                <button id="reset-timer" class="btn">é‡ç½®</button>
                
                <div id="timer-status" style="margin-top: 20px; font-weight: bold;"></div>
            </div>
        </div>
        
        <div id="rewards-tab" class="tab-content">
            <h2>å¥–åŠ±å…‘æ¢ä¸­å¿ƒ</h2>
            <p>ä½¿ç”¨ç§¯åˆ†å…‘æ¢ä½ å–œæ¬¢çš„å¥–åŠ±å§ï¼</p>
            
            <div class="form-group">
                <button id="add-reward-btn" class="btn">æ·»åŠ æ–°å¥–åŠ±</button>
            </div>
            
            <div class="rewards-list" id="rewards-container">
                <!-- å¥–åŠ±å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div id="history-tab" class="tab-content">
            <h2>å…‘æ¢è®°å½•</h2>
            <p>æŸ¥çœ‹ä½ å·²ç»å…‘æ¢çš„å¥–åŠ±è®°å½•</p>
            
            <div class="history-list" id="history-container">
                <!-- å…‘æ¢è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡† -->
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ·»åŠ æ–°ä»»åŠ¡</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="task-form">
                <div class="form-group">
                    <label for="task-name">ä»»åŠ¡åç§°</label>
                    <input type="text" id="task-name" required>
                </div>
                <div class="form-group">
                    <label for="task-description">ä»»åŠ¡æè¿°</label>
                    <textarea id="task-description" placeholder="å¯é€‰çš„è¯¦ç»†æè¿°..."></textarea>
                </div>
                <div class="form-group">
                    <label for="task-day">æ—¥æœŸ</label>
                    <select id="task-day" required>
                        <option value="1">å‘¨ä¸€</option>
                        <option value="2">å‘¨äºŒ</option>
                        <option value="3">å‘¨ä¸‰</option>
                        <option value="4">å‘¨å››</option>
                        <option value="5">å‘¨äº”</option>
                        <option value="6">å‘¨å…­</option>
                        <option value="7">å‘¨æ—¥</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ—¶é—´èŒƒå›´</label>
                    <div class="time-inputs">
                        <div style="flex: 1;">
                            <label for="task-start-time">å¼€å§‹æ—¶é—´</label>
                            <input type="time" id="task-start-time" min="07:00" max="23:00" required>
                        </div>
                        <div style="flex: 1;">
                            <label for="task-end-time">ç»“æŸæ—¶é—´</label>
                            <input type="time" id="task-end-time" min="07:00" max="23:00" required>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="task-points">ç§¯åˆ†å¥–åŠ±</label>
                    <input type="number" id="task-points" min="1" max="100" value="10" required>
                </div>
                <div class="form-group">
                    <label for="task-category">ä»»åŠ¡ç±»åˆ«</label>
                    <select id="task-category" required>
                        <option value="å­¦ä¹ ">å­¦ä¹ </option>
                        <option value="å®¶åŠ¡">å®¶åŠ¡</option>
                        <option value="å…´è¶£">å…´è¶£</option>
                        <option value="è¿åŠ¨">è¿åŠ¨</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                <button type="submit" class="btn">æ·»åŠ ä»»åŠ¡</button>
            </form>
        </div>
    </div>
    
    <!-- æ·»åŠ å¥–åŠ±æ¨¡æ€æ¡† -->
    <div id="reward-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ·»åŠ æ–°å¥–åŠ±</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="reward-form">
                <div class="form-group">
                    <label for="reward-name">å¥–åŠ±åç§°</label>
                    <input type="text" id="reward-name" required>
                </div>
                <div class="form-group">
                    <label for="reward-cost">æ‰€éœ€ç§¯åˆ†</label>
                    <input type="number" id="reward-cost" min="1" max="1000" value="50" required>
                </div>
                <div class="form-group">
                    <label for="reward-description">å¥–åŠ±æè¿°</label>
                    <input type="text" id="reward-description">
                </div>
                <button type="submit" class="btn">æ·»åŠ å¥–åŠ±</button>
            </form>
        </div>
    </div>
    
    <script>
        // åº”ç”¨çŠ¶æ€ç®¡ç†
        const state = {
            points: parseInt(localStorage.getItem('points')) || 0,
            tasks: JSON.parse(localStorage.getItem('tasks')) || [],
            rewards: JSON.parse(localStorage.getItem('rewards')) || [], // æ¸…ç©ºæ‰€æœ‰é»˜è®¤å¥–åŠ±
            history: JSON.parse(localStorage.getItem('history')) || [],
            timer: {
                minutes: 25,
                seconds: 0,
                running: false,
                interval: null
            }
        };
        
        // DOMå…ƒç´ 
        const elements = {
            totalPoints: document.getElementById('total-points'),
            calendarGrid: document.getElementById('calendar-grid'),
            timerDisplay: document.getElementById('timer-display'),
            timerMinutes: document.getElementById('timer-minutes'),
            startTimer: document.getElementById('start-timer'),
            pauseTimer: document.getElementById('pause-timer'),
            resetTimer: document.getElementById('reset-timer'),
            timerStatus: document.getElementById('timer-status'),
            rewardsContainer: document.getElementById('rewards-container'),
            historyContainer: document.getElementById('history-container'),
            taskModal: document.getElementById('task-modal'),
            rewardModal: document.getElementById('reward-modal'),
            taskForm: document.getElementById('task-form'),
            rewardForm: document.getElementById('reward-form'),
            tabs: document.querySelectorAll('.tab'),
            tabContents: document.querySelectorAll('.tab-content'),
            clearTasksBtn: document.getElementById('clear-tasks-btn')
        };
        
        // åˆå§‹åŒ–åº”ç”¨
        function init() {
            updatePointsDisplay();
            generateCalendarGrid();
            renderTasks();
            renderRewards();
            renderHistory();
            setupEventListeners();
        }
        
        // æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
        function updatePointsDisplay() {
            elements.totalPoints.textContent = state.points;
            localStorage.setItem('points', state.points);
        }
        
        // ç”Ÿæˆæ—¥å†ç½‘æ ¼
        function generateCalendarGrid() {
            // æ¸…ç©ºç°æœ‰å†…å®¹
            elements.calendarGrid.innerHTML = '';
            
            // æ·»åŠ å·¦ä¸Šè§’ç©ºç™½å•å…ƒæ ¼
            const emptyCell = document.createElement('div');
            emptyCell.className = 'calendar-header';
            elements.calendarGrid.appendChild(emptyCell);
            
            // æ·»åŠ æ˜ŸæœŸæ ‡é¢˜
            const days = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
            days.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-header';
                dayHeader.textContent = day;
                elements.calendarGrid.appendChild(dayHeader);
            });
            
            // ç”Ÿæˆæ—¶é—´è¡Œï¼ˆ7:00-23:00ï¼‰
            for (let hour = 7; hour <= 23; hour++) {
                // æ—¶é—´æ ‡é¢˜
                const timeHeader = document.createElement('div');
                timeHeader.className = 'time-slot';
                timeHeader.textContent = `${hour}:00`;
                elements.calendarGrid.appendChild(timeHeader);
                
                // æ¯å¤©çš„æ—¶é—´æ§½
                for (let day = 1; day <= 7; day++) {
                    const dayCell = document.createElement('div');
                    dayCell.className = 'day-cell';
                    dayCell.id = `cell-${day}-${hour}`;
                    dayCell.dataset.day = day;
                    dayCell.dataset.hour = hour;
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    dayCell.addEventListener('click', function(e) {
                        // å¦‚æœç‚¹å‡»çš„æ˜¯ä»»åŠ¡å…ƒç´ ï¼Œåˆ™ä¸è§¦å‘æ·»åŠ ä»»åŠ¡
                        if (!e.target.closest('.task')) {
                            openTaskModalWithTime(day, hour);
                        }
                    });
                    
                    elements.calendarGrid.appendChild(dayCell);
                }
            }
        }
        
        // æ‰“å¼€ä»»åŠ¡æ¨¡æ€æ¡†å¹¶é¢„è®¾æ—¶é—´
        function openTaskModalWithTime(day, hour) {
            // è®¾ç½®æ—¥æœŸ
            document.getElementById('task-day').value = day;
            
            // è®¾ç½®å¼€å§‹æ—¶é—´
            const startTime = `${hour.toString().padStart(2, '0')}:00`;
            document.getElementById('task-start-time').value = startTime;
            
            // è®¾ç½®ç»“æŸæ—¶é—´ï¼ˆé»˜è®¤1å°æ—¶åï¼‰
            let endHour = hour + 1;
            if (endHour > 23) endHour = 23;
            const endTime = `${endHour.toString().padStart(2, '0')}:00`;
            document.getElementById('task-end-time').value = endTime;
            
            // æ‰“å¼€æ¨¡æ€æ¡†
            elements.taskModal.style.display = 'flex';
        }
        
        // æ¸²æŸ“ä»»åŠ¡
        function renderTasks() {
            // æ¸…ç©ºæ‰€æœ‰ä»»åŠ¡æ§½
            for (let day = 1; day <= 7; day++) {
                for (let hour = 7; hour <= 23; hour++) {
                    const cell = document.getElementById(`cell-${day}-${hour}`);
                    if (cell) cell.innerHTML = '';
                }
            }
            
            // æ·»åŠ ä»»åŠ¡åˆ°å¯¹åº”æ—¶é—´æ§½
            state.tasks.forEach(task => {
                if (!task.completed) {
                    // è§£æå¼€å§‹æ—¶é—´
                    const [startHour, startMinute] = task.startTime.split(':').map(Number);
                    const [endHour, endMinute] = task.endTime.split(':').map(Number);
                    
                    // å°†ä»»åŠ¡æ·»åŠ åˆ°å¯¹åº”çš„å¤©å’Œå°æ—¶æ§½
                    for (let hour = startHour; hour <= endHour; hour++) {
                        const cell = document.getElementById(`cell-${task.day}-${hour}`);
                        if (cell) {
                            const taskElement = document.createElement('div');
                            taskElement.className = `task ${task.category.toLowerCase()}`;
                            taskElement.dataset.id = task.id;
                            
                            // æ˜¾ç¤ºæ—¶é—´èŒƒå›´
                            const timeDisplay = `${task.startTime} - ${task.endTime}`;
                            
                            // æ„å»ºä»»åŠ¡HTMLï¼ŒåŒ…æ‹¬æè¿°ï¼ˆå¦‚æœæœ‰ï¼‰
                            let taskHTML = `
                                <div>
                                    <strong>${task.name}</strong>
                                    <div class="task-time">${timeDisplay}</div>
                            `;
                            
                            if (task.description && task.description.trim() !== '') {
                                taskHTML += `<div class="task-description">${task.description}</div>`;
                            }
                            
                            taskHTML += `
                                </div>
                                <div class="task-actions">
                                    <span class="task-points">+${task.points}</span>
                                    <button class="btn btn-small complete-task">å®Œæˆ</button>
                                    <button class="btn btn-small btn-warning cancel-task">å–æ¶ˆ</button>
                                </div>
                            `;
                            
                            taskElement.innerHTML = taskHTML;
                            cell.appendChild(taskElement);
                        }
                    }
                }
            });
        }
        
        // æ¸²æŸ“å¥–åŠ±
        function renderRewards() {
            elements.rewardsContainer.innerHTML = '';
            
            if (state.rewards.length === 0) {
                elements.rewardsContainer.innerHTML = '<p>è¿˜æ²¡æœ‰æ·»åŠ å¥–åŠ±ï¼Œç‚¹å‡»"æ·»åŠ æ–°å¥–åŠ±"æŒ‰é’®åˆ›å»ºç¬¬ä¸€ä¸ªå¥–åŠ±å§ï¼</p>';
                return;
            }
            
            state.rewards.forEach(reward => {
                const rewardCard = document.createElement('div');
                rewardCard.className = 'reward-card';
                rewardCard.dataset.id = reward.id;
                
                rewardCard.innerHTML = `
                    <button class="delete-btn delete-reward" title="åˆ é™¤å¥–åŠ±">Ã—</button>
                    <h3>${reward.name}</h3>
                    <p>${reward.description || ''}</p>
                    <div class="reward-cost">${reward.cost} ç§¯åˆ†</div>
                    <div class="reward-actions">
                        <button class="btn redeem-btn" ${state.points < reward.cost ? 'disabled' : ''}>
                            å…‘æ¢
                        </button>
                    </div>
                `;
                
                elements.rewardsContainer.appendChild(rewardCard);
            });
        }
        
        // æ¸²æŸ“å…‘æ¢å†å²
        function renderHistory() {
            elements.historyContainer.innerHTML = '';
            
            if (state.history.length === 0) {
                elements.historyContainer.innerHTML = '<p>è¿˜æ²¡æœ‰å…‘æ¢è®°å½•ï¼Œå¿«å»å…‘æ¢å¥–åŠ±å§ï¼</p>';
                return;
            }
            
            state.history.forEach(record => {
                const historyCard = document.createElement('div');
                historyCard.className = 'history-card';
                
                historyCard.innerHTML = `
                    <h3>${record.name}</h3>
                    <p>${record.description || ''}</p>
                    <div class="reward-cost">-${record.cost} ç§¯åˆ†</div>
                    <div class="history-date">${record.date}</div>
                `;
                
                elements.historyContainer.appendChild(historyCard);
            });
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æ ‡ç­¾é¡µåˆ‡æ¢
            elements.tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    
                    // æ›´æ–°æ´»åŠ¨æ ‡ç­¾
                    elements.tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // æ˜¾ç¤ºå¯¹åº”å†…å®¹
                    elements.tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabId}-tab`) {
                            content.classList.add('active');
                        }
                    });
                });
            });
            
            // æ·»åŠ ä»»åŠ¡æŒ‰é’®
            document.getElementById('add-task-btn').addEventListener('click', () => {
                elements.taskModal.style.display = 'flex';
            });
            
            // æ¸…é™¤æ‰€æœ‰ä»»åŠ¡æŒ‰é’®
            elements.clearTasksBtn.addEventListener('click', () => {
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ä»»åŠ¡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                    state.tasks = [];
                    localStorage.setItem('tasks', JSON.stringify(state.tasks));
                    renderTasks();
                    alert('æ‰€æœ‰ä»»åŠ¡å·²æ¸…é™¤ï¼');
                }
            });
            
            // æ·»åŠ å¥–åŠ±æŒ‰é’®
            document.getElementById('add-reward-btn').addEventListener('click', () => {
                elements.rewardModal.style.display = 'flex';
            });
            
            // å…³é—­æ¨¡æ€æ¡†
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    elements.taskModal.style.display = 'none';
                    elements.rewardModal.style.display = 'none';
                });
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            window.addEventListener('click', (e) => {
                if (e.target === elements.taskModal) {
                    elements.taskModal.style.display = 'none';
                }
                if (e.target === elements.rewardModal) {
                    elements.rewardModal.style.display = 'none';
                }
            });
            
            // ä»»åŠ¡è¡¨å•æäº¤
            elements.taskForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const taskName = document.getElementById('task-name').value;
                const taskDescription = document.getElementById('task-description').value;
                const taskDay = document.getElementById('task-day').value;
                const taskStartTime = document.getElementById('task-start-time').value;
                const taskEndTime = document.getElementById('task-end-time').value;
                const taskPoints = parseInt(document.getElementById('task-points').value);
                const taskCategory = document.getElementById('task-category').value;
                
                // éªŒè¯æ—¶é—´èŒƒå›´
                if (taskStartTime >= taskEndTime) {
                    alert('ç»“æŸæ—¶é—´å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´ï¼');
                    return;
                }
                
                const newTask = {
                    id: Date.now(),
                    name: taskName,
                    description: taskDescription,
                    day: taskDay,
                    startTime: taskStartTime,
                    endTime: taskEndTime,
                    points: taskPoints,
                    category: taskCategory,
                    completed: false
                };
                
                state.tasks.push(newTask);
                localStorage.setItem('tasks', JSON.stringify(state.tasks));
                
                renderTasks();
                elements.taskModal.style.display = 'none';
                elements.taskForm.reset();
            });
            
            // å¥–åŠ±è¡¨å•æäº¤
            elements.rewardForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const rewardName = document.getElementById('reward-name').value;
                const rewardCost = parseInt(document.getElementById('reward-cost').value);
                const rewardDescription = document.getElementById('reward-description').value;
                
                const newReward = {
                    id: Date.now(),
                    name: rewardName,
                    cost: rewardCost,
                    description: rewardDescription
                };
                
                state.rewards.push(newReward);
                localStorage.setItem('rewards', JSON.stringify(state.rewards));
                
                renderRewards();
                elements.rewardModal.style.display = 'none';
                elements.rewardForm.reset();
            });
            
            // å®Œæˆä»»åŠ¡
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('complete-task')) {
                    const taskElement = e.target.closest('.task');
                    const taskId = parseInt(taskElement.dataset.id);
                    
                    const task = state.tasks.find(t => t.id === taskId);
                    if (task) {
                        task.completed = true;
                        state.points += task.points;
                        
                        localStorage.setItem('tasks', JSON.stringify(state.tasks));
                        updatePointsDisplay();
                        renderTasks();
                        renderRewards();
                        
                        // æ˜¾ç¤ºå®Œæˆä»»åŠ¡æç¤º
                        alert(`æ­å–œå®Œæˆä»»åŠ¡ï¼è·å¾— ${task.points} ç§¯åˆ†ï¼`);
                    }
                }
            });
            
            // å–æ¶ˆä»»åŠ¡
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('cancel-task')) {
                    const taskElement = e.target.closest('.task');
                    const taskId = parseInt(taskElement.dataset.id);
                    
                    const task = state.tasks.find(t => t.id === taskId);
                    if (task) {
                        if (confirm(`ç¡®å®šè¦å–æ¶ˆä»»åŠ¡ "${task.name}" å—ï¼Ÿ`)) {
                            // ä»ä»»åŠ¡åˆ—è¡¨ä¸­åˆ é™¤
                            state.tasks = state.tasks.filter(t => t.id !== taskId);
                            localStorage.setItem('tasks', JSON.stringify(state.tasks));
                            
                            renderTasks();
                            
                            alert(`å·²å–æ¶ˆä»»åŠ¡ "${task.name}"ï¼`);
                        }
                    }
                }
            });
            
            // å…‘æ¢å¥–åŠ±
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('redeem-btn')) {
                    const rewardCard = e.target.closest('.reward-card');
                    const rewardId = parseInt(rewardCard.dataset.id);
                    
                    const reward = state.rewards.find(r => r.id === rewardId);
                    if (reward && state.points >= reward.cost) {
                        if (confirm(`ç¡®å®šè¦å…‘æ¢ "${reward.name}" å—ï¼Ÿè¿™å°†èŠ±è´¹ ${reward.cost} ç§¯åˆ†ã€‚`)) {
                            state.points -= reward.cost;
                            
                            // æ·»åŠ åˆ°å†å²è®°å½•
                            const now = new Date();
                            const historyRecord = {
                                ...reward,
                                date: `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`
                            };
                            state.history.unshift(historyRecord);
                            
                            localStorage.setItem('points', state.points);
                            localStorage.setItem('history', JSON.stringify(state.history));
                            
                            updatePointsDisplay();
                            renderRewards();
                            renderHistory();
                            
                            alert(`æˆåŠŸå…‘æ¢ "${reward.name}"ï¼`);
                        }
                    }
                }
            });
            
            // åˆ é™¤å¥–åŠ±
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-reward')) {
                    const rewardCard = e.target.closest('.reward-card');
                    const rewardId = parseInt(rewardCard.dataset.id);
                    
                    const reward = state.rewards.find(r => r.id === rewardId);
                    if (reward) {
                        if (confirm(`ç¡®å®šè¦åˆ é™¤å¥–åŠ± "${reward.name}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`)) {
                            // ä»å¥–åŠ±åˆ—è¡¨ä¸­åˆ é™¤
                            state.rewards = state.rewards.filter(r => r.id !== rewardId);
                            localStorage.setItem('rewards', JSON.stringify(state.rewards));
                            
                            renderRewards();
                            
                            alert(`å·²åˆ é™¤å¥–åŠ± "${reward.name}"ï¼`);
                        }
                    }
                }
            });
            
            // ç•ªèŒ„é’ŸåŠŸèƒ½
            elements.startTimer.addEventListener('click', startTimer);
            elements.pauseTimer.addEventListener('click', pauseTimer);
            elements.resetTimer.addEventListener('click', resetTimer);
            elements.timerMinutes.addEventListener('change', updateTimerDisplay);
        }
        
        // ç•ªèŒ„é’ŸåŠŸèƒ½
        function startTimer() {
            if (!state.timer.running) {
                state.timer.running = true;
                state.timer.minutes = parseInt(elements.timerMinutes.value) || 25;
                state.timer.seconds = 0;
                
                elements.startTimer.disabled = true;
                elements.pauseTimer.disabled = false;
                elements.timerMinutes.disabled = true;
                
                updateTimerDisplay();
                elements.timerStatus.textContent = "ä¸“æ³¨æ—¶é—´å¼€å§‹ï¼åŠ æ²¹ï¼";
                
                state.timer.interval = setInterval(() => {
                    if (state.timer.seconds === 0) {
                        if (state.timer.minutes === 0) {
                            // è®¡æ—¶ç»“æŸ
                            clearInterval(state.timer.interval);
                            elements.timerStatus.textContent = "æ—¶é—´åˆ°ï¼ä¼‘æ¯ä¸€ä¸‹å§ï¼";
                            elements.startTimer.disabled = false;
                            elements.pauseTimer.disabled = true;
                            elements.timerMinutes.disabled = false;
                            state.timer.running = false;
                            
                            // æ’­æ”¾æç¤ºéŸ³æˆ–æ˜¾ç¤ºé€šçŸ¥
                            alert("ç•ªèŒ„é’Ÿæ—¶é—´ç»“æŸï¼");
                            return;
                        }
                        state.timer.minutes--;
                        state.timer.seconds = 59;
                    } else {
                        state.timer.seconds--;
                    }
                    
                    updateTimerDisplay();
                }, 1000);
            }
        }
        
        function pauseTimer() {
            if (state.timer.running) {
                clearInterval(state.timer.interval);
                state.timer.running = false;
                elements.startTimer.disabled = false;
                elements.pauseTimer.disabled = true;
                elements.timerStatus.textContent = "è®¡æ—¶å·²æš‚åœ";
            }
        }
        
        function resetTimer() {
            clearInterval(state.timer.interval);
            state.timer.running = false;
            state.timer.minutes = parseInt(elements.timerMinutes.value) || 25;
            state.timer.seconds = 0;
            
            elements.startTimer.disabled = false;
            elements.pauseTimer.disabled = true;
            elements.timerMinutes.disabled = false;
            
            updateTimerDisplay();
            elements.timerStatus.textContent = "";
        }
        
        function updateTimerDisplay() {
            const minutes = state.timer.minutes.toString().padStart(2, '0');
            const seconds = state.timer.seconds.toString().padStart(2, '0');
            elements.timerDisplay.textContent = `${minutes}:${seconds}`;
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        init();
    </script>
</body>
</html>
